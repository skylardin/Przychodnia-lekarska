\documentclass[a4paper]{article} \usepackage{polski} \usepackage[cp1250]{inputenc} \usepackage{url}

\title{\bf{Elektroniczna przychodnia lekarska (PHP, MYSQL)}} \author{{\em Pawe³ Wilczek }{\em £ukasz Szkaradek } {\em £ukasz Mamak}} \date{}

\begin{document}

\begin{titlepage} \maketitle \thispagestyle{empty} \bigskip \begin{center} Zespo³owe przedsiêwziêcie in¿ynierskie

Informatyka

Rok. akad. 2017/2018, sem. I

Prowadz¹cy: dr hab. Marcin Mazur \end{center} \end{titlepage}

\tableofcontents \thispagestyle{empty}


\newpage

\section{Opis projektu}
\label{Opisprojektu}

\subsection{Cz³onkowie zespo³u}
\label{Cz³onkowie}

\begin{enumerate} \item £ukasz Szkaradek (kierownik projektu). \item Pawe³ Wilczek. \item £ukasz Mamak. \end{enumerate}

\subsection{Cel projektu (produkt)}
\label{Celprojektu}

Celem projektu jest stworzenie strony internetowej z zastosowaniem php i mysql, która ma na celu obs³ugê wirtualnej przychodni lekarskiej oraz zwiêkszenie jej wydajnoœci.

\subsection{Potencjalny odbiorca produktu (klient)}
\label{Potencjalnyodbiorcaproduktu}

Klientem mo¿e byæ przychodnia lekarska chc¹ca usprawniæ wydajnoœæ niskim kosztem.

\subsection{Metodyka}
\label{Metodyka}

Projekt bêdzie realizowany przy u¿yciu (zaadaptowanej do istniej¹cych warunków) metodyki {\em Scrum}.

\section{Wymagania u¿ytkownika}
\label{Wymaganiauzytkownika}

\subsection{User story 1}
\label{Userstory1}

Jako pacjent, chcia³bym mieæ mo¿liwoœæ zapisu do danego specjalisty za poœrednictwem strony internetowej przychodni, dziêki czemu nie musia³bym udaæ siê tam osobiœcie i móg³bym przez to lepiej zarz¹dzaæ czasem jaki mam do dyspozycji danego dnia.

\subsection{User story 2}
\label{Userstory2}
Jako pacjent chcia³bym mieæ wgl¹d do mojej karty pacjenta poprzez stronê przychodni tak abym móg³ ³atwo sprawdziæ aktualn¹ listê moich wizyt z lekarzem.

\subsection{User story 3}
\label{Userstory3}

Jako dyrektor placówki chcia³bym posiadaæ konto admina by zarz¹dzaæ elektroniczn¹ przychodni¹ tak, aby w pe³ni czuwaæ nad moimi pracownikami.

\subsection{User story 4}
\label{Userstory4}

Jako lekarz chce ¿eby oprogramowanie przychodni mia³o ³atwy i szybki dostêp do wszystkich moich aktualnych wizyt.


\subsection{User story 5}
\label{Userstory5}

Jako recepcjonista w przychodni chcia³bym mieæ dostêp do elektronicznej bazy przychodni co w przeciwieñstwie do tradycyjnej formy skróci³o by mój czas reakcji i zmniejszy³o iloœæ mojej pracy.

\subsection{User story 6}
\label{Userstory6}

Jako pacjent chcia³bym mieæ dostêp do aktualnoœci w przychodni takie jak opóŸnienia w przyjmowaniu przez lekarzy, tak aby w takim przypadku inaczej zagospodarowaæ czas.

\subsection{User story 7}
\label{Userstory7}

Jako dyrektor chcia³bym, aby platforma internetowa zwiêkszy³a wydajnoœæ naszej placówki poprzez ³atwoœæ w rejestracji i katalogowaniu danych.

\subsection{User story 8}
\label{Userstory8}

Jako lekarz chcia³bym mieæ dostêp do elektronicznej wersji karty pacjenta co umo¿liwia³o by mi poznanie historii choroby pacjenta i jej edycje w razie koniecznoœci.


\section{Harmonogram}
\label{Harmonogram}

\subsection{Rejestr zadañ (Product Backlog)}
\label{Rejestrzadan}

\begin{itemize} \item Data rozpoczêcia: 11.10.2017. \item Data zakoñczenia: 15.11.2017. \end{itemize}

\subsection{Sprint 1}
\label{Sprint1}

\begin{itemize} \item Data rozpoczêcia: 15.11.2017. \item Data zakoñczenia: 29.11.2017. \item Scrum Master: £ukasz Szkaradek. \item Product Owner: £ukasz Mamak. \item Development Team: £ukasz Mamak, Pawe³ Wilczek, £ukasz Szkaradek. \end{itemize}

\subsection{Sprint 2}
\label{Sprint2}

\begin{itemize} \item Data rozpoczêcia: 29.11.2017. \item Data zakoñczenia: 27.12.2017. \item Scrum Master: £ukasz Mamak. \item Product Owner: Pawe³ Wilczek. \item Development Team: Pawe³ Wilczek, £ukasz Szkaradek, £ukasz Mamak. \end{itemize}

\subsection{Sprint 3}
\label{Sprint3}

\begin{itemize} \item Data rozpoczêcia: 27.12.2017. \item Data zakoñczenia: 24.01.2018. \item Scrum Master: Pawe³ Wilczek. \item Product Owner: £ukasz Szkaradek. \item Development Team: £ukasz Szkaradek, £ukasz Mamak, Pawe³ Wilczek. \end{itemize}


\section{Product Backlog}
\label{ProductBacklog}

\subsection{Backlog Item 1}\label{BacklogItem1} \paragraph{Tytu³ zadania.} Stworzenie  bazy danych. \paragraph{Opis zadania.} Stworzenie bazy danych, która s³u¿yæ bêdzie do testowania pocz¹tkowych zadañ. \paragraph{Priorytet.} Œredni. \paragraph{Definition of Done.} Stworzenie w MYSQL bazy danych i tablic: 
\newline

 \textbf{SPECJALIZACJE: }

\begin{itemize}
\item id specjalizacji (automatycznie przypisywany numer),
\item nazwa specjalizacji (nazwa specjalizacji), 
\end{itemize}


 \textbf{AKTUALNOŒCI: }

\begin{itemize}
\item id aktualnosci (automatycznie przypisywany numer),
\item data (data napisania aktualnoœci) , 
\item opis (treœæ aktualnoœci)
\end{itemize}

\textbf{PACJENCI: }
  
\begin{itemize}
\item id pacjenta (automatycznie przypisywany numer), 
\item imie (imiê pacjenta), 
\item nazwisko (nazwisko pacjenta), 
\item pesel (pesel pacjenta), 
\item karta pacjenta (treœæ karty pacjenta), 
\item nr telefonu
\item kod (automatycznie generowany kod, który wraz z peselem bêdzie umo¿liwia³ logowanie siê pacjenta)
\end {itemize}\newline

 \textbf{SPOTKANIA:}
 
\begin{itemize}
\item id spotkania (automatycznie przypisywany numer),
\item id specjalizacji (numer odnosz¹cy siê do konkretnego wiersza w tablicy specjalizacje),
\item id lekarza (numer odnosz¹cy siê do konkretnego wiersza w tablicy lekarze),
\item id osoby (numer odnosz¹cy siê do konkretnego wiersza w tablicy pacjenci),
\item data odbycia (data wpisywana przez recepcjonistê, która okreœla datê spotkania z lekarzem),
\item data zapisu (automatycznie przypisywana data podczas tworzenia wiersza),
\item stan (równa siê 0 lub 1, w zale¿noœci czy spotkanie zosta³o zaakceptowane przez recepcjonistê)
\end {itemize}\newline
\textbf{LEKARZE:}

\begin {itemize}
\item id lekarza (automatycznie przypisywany numer),
\item login (login u¿ywany przy logowaniu na stronie recepcji),
\item haslo (has³o u¿ywane przy logowaniu na stronie recepcji),
\item imie (imiê lekarza),
\item nazwisko (nazwisko lekarza),
\item id specjalizacji (numer odnosz¹cy siê do konkretnego wiersza w tablicy specjalizacje, okreœla jak¹ specjalizacjê posiada dany lekarz),
\item nr pokoju (numer pokoju w którym dany lekarz przyjmuje),
 
 \end {itemize}


\subsection{Backlog Item 2} \label{BacklogItem2}\paragraph{Tytu³ zadania.} Strona tytu³owa oraz formularz logowania pacjenta. \paragraph{Opis zadania.} Stworzenie strony g³ównej wraz z interfejsem i logowaniem dla pacjenta. \paragraph{Priorytet.} Œredni. \paragraph{Definition of Done.} Napisanie w jêzyku PHP strony g³ównej w której bêd¹ zawarte:
\newline
\newline 1. Formularz logowania pacjenta (poprzez pesel i kod).
\newline
\newline 2. Odnoœniki do reszty podstron takich jak:
\begin{itemize}
\item formularz rejestracji pacjenta
\item strony recepcji.
\end {itemize}

\textit{\textbf{Strona zawieraæ bêdzie skrypt, który po wykryciu zmiennych wys³anych przez formularz logowania pacjenta wyœwietli:}}

\begin{itemize}
\item imiê pacjenta, 
\item nazwisko pacjenta, 
\item pesel pacjenta, 
\item listê umówionych spotkañ z lekarzami,
\item formularz przez, który tworzyæ bêdzie spotkania wraz z skryptem obs³uguj¹cym dan¹ operacjê (dodanie do tablicy "spotkania" danych: id specjalizacji, id osoby).

\end{itemize}

\subsection{Backlog Item 3} \label{BacklogItem3}\paragraph{Tytu³ zadania.} Aktualnoœci. \paragraph{Opis zadania.} Dodanie do strony g³ównej listê aktualnoœci. \paragraph{Priorytet.} Niski. \paragraph{Definition of Done.}  Edycja strony g³ównej tak aby w przejrzysty sposób wyœwietla³a dane z tablicy "aktualnoœci":
- Data aktualnoœci (data),
- Treœæ aktualnoœci (opis).

\subsection{Backlog Item 4} \label{BacklogItem4}\paragraph{Tytu³ zadania.} Formularz zapisu dla pacjentów. \paragraph{Opis zadania.} Stworzenie strony dziêki której bêdzie mo¿na zapisaæ siê do listy pacjentów. \paragraph{Priorytet.} Niski. \paragraph{Definition of Done.} Napisanie strony w jêzyku PHP zawieraj¹cej formularz z danymi do wprowadzenia (Imiê, Nazwisko, Pesel, Telefon kontaktowy). Po otrzymaniu danych zostan¹ one wprowadzone do tablicy "pacjenci". Ponadto strona po wype³nieniu formularza generowaæ bêdzie 5-cyfrowy kod, który równie¿ bêdzie wprowadzany do tablicy.



\subsection{Backlog Item 5} \label{BacklogItem5}\paragraph{Tytu³ zadania.} Aktualizacja bazy danych. \paragraph{Opis zadania.} Dodanie do bazy danych potrzebnych tablic i ewentualna edycja starych tablic w razie potrzeby. \paragraph{Priorytet.} Wysoki. \paragraph{Definition of Done.} Dodanie do bazy danych, tablic:
\newline
\newline
 \textbf{RECEPCJA:}
 \begin{itemize}
\item id recepcjonisty  (automatycznie przypisywany numer),
\item imie (imiê recepcjonisty),
\item nazwisko (nazwisko recepcjonisty),
\item login (login u¿ywany przy logowaniu na stronie recepcji),
\item  haslo (has³o u¿ywane przy logowaniu na stronie recepcji)
\end {itemize}
\newline
\textbf{DYREKTOR:}
\begin {itemize}
\item id dyrektora  (automatycznie przypisywany numer),
\item imie (imiê dyrektora),
\item nazwisko (nazwisko dyrektora),
\item login (login u¿ywany przy logowaniu na stronie recepcji),
\item haslo (has³o u¿ywane przy logowaniu na stronie recepcji).
\end {itemize}
\newline
\textit{\textbf{Stworzenie 2 widoków, u³atwiaj¹cych obs³ugê strony:}}
\newline
 
\textbf{LEKARZE:}
\begin {itemize}
\item imie (imiê lekarza z tablicy "lekarze"),
\item nazwisko (nazwisko lekarza z tablicy "lekarze"),
\item specjalizacja (nazwa specjalizacji z tablicy "specjalizacje", odpowiednia dla konkretnego lekarza),
\item  nr pokoju (nr pokoju z tablicy "lekarze")
\end {itemize}\newline

\textbf{LISTA:}
\begin {itemize}
\item id spotkania (id spotkania z tablicy "spotkania"),
\item id osoby (id pacjenta z tablicy "pacjenci" odpowiednie dla konkretnego spotkania),
\item id lekarza (id lekarza z tablicy "lekarze" odpowiednie dla konkretnego spotkania),
\item pesel (pesel z tablicy "pacjenci"),
\item imie osoby (imiê osoby z tablicy "pacjenci"),
\item nazwisko osoby (nazwisko osoby z tablicy "pacjenci"),
\item specjalizacja (nazwa specjalizacji z tablicy "specjalizacje"),
\item imie lekarza (imiê lekarza z tablicy "lekarze"),
\item nazwisko lekarza (nazwisko lekarza z tablicy "lekarze"),
\item nr pokoju (numer pokoju z tablicy "lekarze"),
\item data odbycia (data odbycia z tablicy "spotkania"),
\item data zapisu (data zapisu z tablicy "spotkania"),
\item stan (stan z tablicy "spotkania")

\end {itemize}



\subsection{Backlog Item 6} \label{BacklogItem6}\paragraph{Tytu³ zadania.} Strona logowania pracowników. \paragraph{Opis zadania.} Napisanie strony, która bêdzie dawaæ dostêp do logowania i wyœwietlania listy opcji dla: dyrektora, recepcjonisty i lekarza. \paragraph{Priorytet.} Œredni. \paragraph{Definition of Done.} Stworzenie strony na, której bêdzie formularz z danymi do wprowadzenia: login, has³o. Wraz z skryptem który po ich otrzymaniu przeszuka tablice: lekarze, dyrektor, recepcja w poszukiwaniu prawid³owoœci. Je¿eli znajdzie wykorzysta funkcjê "session" i wpiszê do niej dane takie jak imiê, nazwisko, id oraz tablica z informacj¹ z której tablicy dana osoba pochodzi. W przypadku wykrycia zmiennych w "session", wypisuje imiê, nazwisko oraz id danej osoby, oraz w zale¿noœci od zmiennej tablica listê odnoœników do strony "zarzadzaj" \\

 \textbf{DLA LEKARZE:}
 \begin {itemize}
\item odnoœnik wraz z informacj¹ w formie GET prosz¹c¹ o listê spotkañ.
\item odnoœnik wraz z informacj¹ w formie GET prosz¹c¹ o kartê pacjenta.
\end {itemize} \\

\textbf{DLA RECEPCJA:}
\begin {itemize}
\item odnoœnik wraz z informacj¹ w formie GET prosz¹c¹ o lista osób zapisanych. 
\item odnoœnik wraz z informacj¹ w formie GET prosz¹c¹ o lista lekarzy .
\item odnoœnik wraz z informacj¹ w formie GET prosz¹c¹ o lista dostêpnych specjalizacji. 
\end{itemize}

 \textbf{DLA DYREKTOR:}
 \begin {itemize}
\item odnoœniki wraz z informacjami w formie GET prosz¹c¹ o mo¿liwoœæ edycji, usuwania, dodawania do tablic:
\item a) lekarze
\item b) specjalizacje
\item c) recepcja
\item d) spotkania
\item e) pacjenci
\item f) aktualnosci
\end {itemize}


\subsection{Backlog Item 7} \label{BacklogItem7}\paragraph{Tytu³ zadania.} Wyœwietlanie, edycja, usuwanie. \paragraph{Opis zadania.} Stworzenie strony obs³uguj¹cych edycjê, wyœwietlanie i usuwanie danych z tablic. \paragraph{Priorytet.} Wysoki. \paragraph{Definition of Done.} Stworzenie strony "zarzadzanie", która po otrzymaniu informacji form¹ GET i zweryfikowaniu uprawnieñ z funkcji "session", bêdzie udostêpniaæ formie formularza wraz skryptem je obs³uguj¹cym opcje dla osób z tablicy:\newline

\textbf{LEKARZE:}
\begin {itemize}
\item listê spotkañ  (wyœwietlanie),
\item kartê pacjenta (wyœwietlanie i edycja)
\end {itemize}
\\
\textbf{RECEPCJA:}
\begin{itemize}
\item listê osób zapisanych (wyœwietlanie i edycja),
\item listê lekarzy (wyœwietlanie),
\item listê dostêpnych specjalizacji (wyœwietlanie)
\end {itemize}
\\
\textbf{DYREKTOR:}
\begin {itemize}
\item listê lekarze (wyœwietlanie, edycja i usuwanie),
\item listê specjalizacje (wyœwietlanie, edycja i usuwanie),
\item listê recepcja (wyœwietlanie, edycja i usuwanie),
\item listê spotkania (wyœwietlanie, edycja i usuwanie),
\item listê pacjenci (wyœwietlanie, edycja i usuwanie),
\item listê aktualnosci (wyœwietlanie, edycja i usuwanie)
\end {itemize}

\section{Sprint 1}\label{Sprint11} \subsection{Cel}\label{Sprint1cel}Stworzenie bazy danych dziêki której mo¿liwe bêdzie przegl¹danie strony tytu³owej i formularza zapisu pacjentów. \subsection{Sprint Planning/Backlog} \label{Sprint1SPB}

\paragraph{Tytu³ zadania.} Stworzenie pocz¹tkowej bazy danych. \begin{itemize} \item Estymata: M. \end{itemize}
\paragraph{Tytu³ zadania.}  Strona tytu³owa oraz formularz logowania pacjenta. \begin{itemize} \item Estymata: L. \end{itemize}
\paragraph{Tytu³ zadania.} Aktualnoœci. \begin{itemize} \item Estymata: S. \end{itemize}



\subsection{Realizacja}\label{Sprint1realizacja}


\paragraph{Tytu³ zadania.} Stworzenie pocz¹tkowej bazy danych. \subparagraph{Wykonawca.} £ukasz Mamak \subparagraph{Realizacja.} Zadaniem do wykonania by³o stworzenie niezbêdnej do dalszych kroków bazy danych. Realizacja tego¿ zadania przebieg³a bez wiêkszych komplikacji. W skrypcie zosta³o utworzonych kilka tabel, pocz¹wszy od aktualnoœci, poprzez tabele pacjenci, lekarze, na tabeli spotkania koñcz¹c. W ka¿dej tabeli zdefiniowany zosta³ klucz g³ówny dla wartoœci "niepowtarzalnych" w zale¿noœci od tabeli. Zdefiniowane zosta³y tak¿e klucze obce, które zosta³y wykorzystane do utworzenia relacji miêdzy par¹ tabel. Podsumowuj¹c, zadanie zosta³o zrealizowane w ca³oœci, bez istotnych do odnotowania problemów, nie wychodz¹cych poza ramy b³êdnego wpisania sk³adni, lub te¿ drobnych literówek. 
\newline
\newline
    Kod programu (œrodowisko \texttt{verbatim}): \begin{verbatim} create database przychodnia character set utf8 collate utf8_unicode_ci;
use przychodnia;
Set time_zone='+1:00';

CREATE TABLE aktualnosci (
id_aktualnosci INT NOT NULL auto_increment,
data TIMESTAMP NOT NULL,
opis VARCHAR(50) NOT NULL,

CONSTRAINT c_pk0 PRIMARY KEY(id_aktualnosci)
) ENGINE = InnoDB; 

CREATE TABLE pacjenci (
id_pacjenta INT NOT NULL auto_increment,
imie VARCHAR(50) NOT NULL,
nazwisko VARCHAR(50) NOT NULL,
karta_pacjenta VARCHAR(255) NOT NULL,
pesel BIGINT NOT NULL,
nr_telefonu BIGINT NOT NULL,
kod VARCHAR(50) NOT NULL,

CONSTRAINT c_pk PRIMARY KEY(id_osoby)
) ENGINE = InnoDB; 

CREATE TABLE lekarze (
id_lekarza INT NOT NULL auto_increment,
login VARCHAR(50) NOT NULL,
haslo VARCHAR(50) NOT NULL,
imie VARCHAR(50) NOT NULL,
nazwisko VARCHAR(50) NOT NULL,
id_specjalizacji INT NOT NULL,
nr_pokoju VARCHAR(50) NOT NULL,

CONSTRAINT c_pk2 PRIMARY KEY(id_lekarza)
) ENGINE = InnoDB; 


CREATE TABLE spotkania (
id_spotkania INT NOT NULL auto_increment,
id_specjalizacji INT NOT NULL,
id_lekarza INT NOT NULL,
id_osoby INT NOT NULL,
data_odbycia VARCHAR(50),
data_zapisu TIMESTAMP NOT NULL,
stan enum('0','1') NOT NULL DEFAULT '0',

CONSTRAINT c_pk3 PRIMARY KEY(id_zabiegu),
CONSTRAINT c_fk FOREIGN KEY(id_specjalizacji) REFERENCES lekarze (id_lekarza)
ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT c_fk2 FOREIGN KEY(id_lekarza) REFERENCES lekarze (id_lekarza)
ON UPDATE CASCADE ON DELETE CASCADE,
CONSTRAINT c_fk3 FOREIGN KEY(id_osoby) REFERENCES pacjenci (id_pacjenta)
ON UPDATE CASCADE ON DELETE CASCADE
) ENGINE = InnoDB; 



CREATE PROCEDURE zatw ()
BEGIN
UPDATE spotkania SET stan='1' WHERE FROM_UNIXTIME(data_odbycia) <= NOW() AND stan='0';
END; \end{verbatim}.

\paragraph{Tytu³ zadania.}  Strona tytu³owa oraz formularz logowania pacjenta. \subparagraph{Wykonawca.} £ukasz Szkaradek \subparagraph{Realizacja.} Celem zadania by³o wykonanie strony internetowej w której zawarte bêd¹ logowanie pacjenta, wyœwietlanie spotkañ danego pacjenta oraz ich dodawanie poprzez formularz. Wykonanie zadania odby³o siê bez wiêkszych trudnoœci, choæ wykonanie niektórych algorytmów takich jak wyœwietlanie wyboru godzin z pominiêciem ju¿ zarezerwowanych oraz przesz³ych godzin czy wyœwietlanie odpowiednich dat dla wybranych dni wymaga³o wiêkszego wysi³ku. Przydatna przy wykonaniu zadania by³a funkcja session, która przechowuje dane a¿ do ich usuniêcia lub wy³¹czenia przegl¹darki. Przy przesy³aniu danych z formularza zosta³a u¿yta forma POST. Zadanie zosta³o wykonane w ca³oœci, a wszystkie jego funkcje dzia³aj¹ prawid³owo.
\newline
\newline
Kod programu (œrodowisko \texttt{PHP}): \begin{verbatim} 
<?php
ob_start();
date_default_timezone_set('Europe/Warsaw');
session_start();
$host="<<ip serwera>>";
$db_user="<<nazwa u¿ytkownika>>";
$db_password="<<has³o u¿ytkowinka>>";
$database="<<nazwa bazy danych>>";
$link= mysqli_connect($host,$db_user,$db_password,$database);
$zat="call zatw()";
$zat_w=mysqli_query($link,$zat);
if (isset($_GET[powrot])) {
session_destroy();
header("Location: index.php");
}
if (isset($_POST[stan])){
$zapytanie="SELECT * FROM pacjenci WHERE pesel='$_POST[pesel]' and kod='$_POST[kod]'";
$wykonaj=mysqli_query($link,$zapytanie);
if(@mysqli_num_rows($wykonaj)){
while($wiersz=mysqli_fetch_assoc($wykonaj)) {
$_SESSION[zalogowany] = "pacjent";
$_SESSION[id_p] = $wiersz['id_pacjenta'];
$_SESSION['baza'] = 'pacjent';
}
} else {
$brak='1';
}
}
?>
<html>
<head>
<title>Przychodnia lekarska</title>
<META http-equiv=Content-Language content=pl>
<META http-equiv=Content-Type content="text/html; charset=windows-1250">
<style>
a {
    color: black;
    text-decoration: none;
}
</style>
</head>
<body style="background-size: 100% 200%;" background="tlo.jpg" bgproperties="fixed">
<center>
<?php if($_SESSION['baza']=="pacjent") {
echo '<a href="?powrot">Powrót</a>';
} else {
echo '<a href="formularz.php">Formularz</a>';
}
?> | <a href="recepcja.php"><?php if($_SESSION['zalogowany']=="ok") {
echo $_SESSION['login'];
} else {
echo 'Zaloguj siê';
}
?></a><br><br>
<img style="margin:-7px;width: 101%; text-align:center;" src="logo.png" alt="Logo" />
<?php
if (isset($brak)) {echo "B³¹d! Brak osoby w bazie!";}
if ($_SESSION[baza] == "pacjent") {
$zapytanie="SELECT * FROM pacjenci WHERE id_pacjenta='$_SESSION[id_p]'";
$wykonaj=mysqli_query($link,$zapytanie);
if(@mysqli_num_rows($wykonaj)){
echo '<table border="1">';
while($wiersz=mysqli_fetch_assoc($wykonaj)) {
echo "<tr><td>Imiê: " . $wiersz['imie'] . "</td><td>Nazwisko: " . $wiersz['nazwisko'] . "</td><td>Pesel: " . $wiersz['pesel'] . "</td><td>Numer telefonu: " . $wiersz['nr_telefonu'] . "</td></tr>";
}
echo '</table><br><br>';
}
if (isset($_POST[w_godziny])){
if ($_POST[w_godziny]=="") {header("Location: index.php");}
$odb = strtotime($_SESSION['w_dnia'] . '-' . date('Y') . ' ' . $_POST[godzina] . '.00');
$zapytanie_x="SELECT * FROM spotkania WHERE id_osoby='$_SESSION[id_p]' and id_specjalizacji='$_SESSION[w_specjalizacji]' and stan='0'";
$wykonaj_x=mysqli_query($link,$zapytanie_x);
if(!@mysqli_num_rows($wykonaj_x)) {
$zapytanie2="INSERT into spotkania (id_specjalizacji, id_lekarza, id_osoby, data_odbycia, data_zapisu, stan) values('".$_SESSION[w_specjalizacji]."', '" . $_SESSION[w_lekarza] ."', '" . $_SESSION[id_p] ."', '" . $odb . "', '" . date('Y-m-j H:i:s') . "', '0')";
$wykonaj2=mysqli_query($link,$zapytanie2);
}
unset($_SESSION['w_dnia']);
unset($_SESSION[w_specjalizacji]);
unset($_SESSION[w_lekarza]);
header("Location: index.php");
}
if (isset($_POST[spotkanie]) or isset($_POST[lekarz])) {
if (isset($_POST[spotkanie])) {
echo "Wybierz lekarza:<br>";
$_SESSION['w_specjalizacji'] = $_POST[id_specjalizacji];
$_SESSION['w_dnia'] = $_POST[dzien];
echo '<form action="" method="POST"><select name="w_lekarza">';
$zapytanie1="SELECT * FROM lekarze where id_specjalizacji='".$_SESSION['w_specjalizacji']."'";
$wykonaj1=mysqli_query($link,$zapytanie1);
while($wiersz1=mysqli_fetch_assoc($wykonaj1)) {
echo '<option value="' . $wiersz1['id_lekarza'] . '">' . $wiersz1['imie'] . " " . $wiersz1['nazwisko'] . "</option>";
}
echo '</select><br> <input type="submit" name="lekarz" value="Dalej"></form><br><br><a href="">Wróæ</a>';
}
if (isset($_POST[lekarz])) {
$_SESSION[w_lekarza] = $_POST[w_lekarza];
$zapytanie="SELECT * FROM spotkania WHERE id_lekarza='".$_POST[w_lekarza]."'";
$wykonaj=mysqli_query($link,$zapytanie);
if(@mysqli_num_rows($wykonaj)){
echo "Wybierz godzinê spotkania:<br>";
while($wiersz=mysqli_fetch_assoc($wykonaj)) {
$zaj[] = date ('j-m G.i' , $wiersz['data_odbycia']);
}
}
$arr = array('9.00', '9.30', '10.00', '10.30', '11.00', '11.30', '12.00', '12.30', '13.00', '13.30', '14.00', '14.30', '15.00', '15.30', '16.00', '16.30', '17.00', '17.30', '18.00', '18.30', '19.00', '19.30');
echo '<form action="" method="POST"><select name="godzina">';
foreach ($arr as &$value) {
if ($_SESSION['w_dnia'] == date ('j-m')) {
if ($value > date('G.i') and !is_numeric(array_search($_SESSION['w_dnia'].' '.$value, $zaj))) {
echo '<option value="' . $value . '">' . $value . "</option>";
}
} else {
echo $_SESSION['w_dnia'].' '.$value;
if (!is_numeric(array_search($_SESSION['w_dnia'].' '.$value, $zaj))) {
echo '<option value="' . $value . '">' . $value . "</option>";
}
}
}
echo '</select></td><br> <input type="submit" name="w_godziny" value="Zapisz"></form><br><br><a href="">Wróæ</a>';
}
} else {
echo '<button onclick="dodaj()">Dodaj spotkanie</button><br><div  style="height:50px">';
$zapytanie_s="SELECT * FROM specjalizacje";
$wykonaj_s=mysqli_query($link,$zapytanie_s);
echo '<form action="" method="POST"><input type="text" hidden=hidden name="pesel" value="' . $_POST[pesel] . '"><input type="text" hidden=hidden name="kod" value="' . $_POST[kod] . '">';
echo '<table style="display: none; text-align:center;" id="dodaj" border="1">';
echo '<tr><td>Wybierz specjalizacjê:</td><td><select name="id_specjalizacji">';
while($wiersz=mysqli_fetch_assoc($wykonaj_s)) {
echo '<option value="' . $wiersz['id_specjalizacji'] . '">' . $wiersz['nazwa_specjalizacji'] . "</option>";
}
echo '</select></td></tr>';
echo '<tr><td>Wybierz dzieñ spotkania:</td><td><select name="dzien">';
$dod = 0;
$dzien = date("N");
$dzien_m = date("j");
$miesiac = date("n");
if ($dzien == 6) {
$dzien = 1;
$dzien_m = $dzien_m + 1;
if ($dzien_m > date("t")) {
$dzien_m = 1;
if ($miesiac == 12) {
$miesiac = 1;
} else {
$miesiac = $miesiac + 1;
}
}
$dzien_m = $dzien_m + 1;
if ($dzien_m > date("t")) {
$dzien_m = 1;
if ($miesiac == 12) {
$miesiac = 1;
} else {
$miesiac = $miesiac + 1;
}
}
}
if ($dzien == 7) {
$dzien_m = $dzien_m + 1;
if ($dzien_m > date("t")) {
$dzien_m = 1;
if ($miesiac == 12) {
$miesiac = 1;
} else {
$miesiac = $miesiac + 1;
}
}
}
while($dzien+$dod <= 5) {
if ($dzien_temp == date("t")) {
$dzien_m = -1 * $dod + 1 ;
if ($miesiac == 12) {
$miesiac = 1;
} else {
$miesiac = $miesiac + 1;
}
}
$dzien_temp = $dzien_m + $dod;
echo '<option value="' . $dzien_temp . '-' . $miesiac . '">' . $dzien_temp . '.' . $miesiac . ' - ';
switch($dzien+$dod) {
    case "1":
        echo "Poniedzia³ek";
    break;
    case "2":
        echo "Wtorek";
    break;
    case "3":
        echo "Œroda";
    break;
    case "4":
        echo "Czwartek";
    break;
    case "5":
        echo "Pi¹tek";
    break;
}

echo "</option>";
$dod = $dod + 1;
}
echo '</select></td></tr></table><input style="display: none" id="p_dodaj" type="submit" name="spotkanie" value="Dodaj"></from><br></div>';
echo '<br><br>Lista spotkañ z lekarzami:<table width="1000" style="text-align:center;" border="1">';
echo "<td>Specjalizacja</td><td>Imie lekarza</td><td>Nazwisko lekarza</td><td>Numer pokoju</td><td>Data spotkania</td><td>Data zapisu</td><td>Oby³o siê</td>";
$zapytanie_z="SELECT * FROM spotkania WHERE id_osoby='".$_SESSION[id_p]."'";
$wykonaj_z=mysqli_query($link,$zapytanie_z);
while($wiersz=mysqli_fetch_assoc($wykonaj_z)) {
$zapytanie_s="SELECT * FROM specjalizacje WHERE id_specjalizacji='".$wiersz['id_specjalizacji']."'";
$wykonaj_s=mysqli_query($link,$zapytanie_s);
while($wiersz_s=mysqli_fetch_assoc($wykonaj_s)) {
$specjalizacja = $wiersz_s['nazwa_specjalizacji'];
}
$zapytanie_l="SELECT * FROM lekarze WHERE id_lekarza='".$wiersz['id_lekarza']."'";
$wykonaj_l=mysqli_query($link,$zapytanie_l);
while($wiersz_l=mysqli_fetch_assoc($wykonaj_l)) {
$imie_lekarza = $wiersz_l['imie'];
$nazwisko_lekarza = $wiersz_l['nazwisko'];
$nr_pokoju = $wiersz_l['nr_pokoju'];
}
echo '<tr><td>'.$specjalizacja.'</td><td>'.$imie_lekarza.'</td><td>'.$nazwisko_lekarza.'</td><td>'.$nr_pokoju.'</td><td>'.date('Y-m-j H:i:s' , $wiersz['data_odbycia']).'</td><td>'.$wiersz['data_zapisu'].'</td><td>';
if ($wiersz['stan']=='0') {
echo 'Nie';
} else {
echo 'Tak';
}
echo'</td>';
}
echo '</table>';
}
} else {
echo'<br><br><br>
<form action="" method="POST">
<table width="300">
<tr>
<td align="right">Pesel:</td>
<td align="let"><input type="text" name="pesel"></td>
<td align="right">Kod:</td>
<td align="let"><input type="text" name="kod"></td>
</tr>
<tr>
<td align="center" colspan="4"><input type="submit" name="stan" value="SprawdŸ"></td>
</tr>
</table>
</form>
<br>
<table border="0" width="300">
<tr>
<td align="left">
Witaj na naszej przychodni lekarskiej. Proszê podaæ swój pesel oraz kod.
</td>
</tr>
<tr>
<td align="right"><i></i></td>
</tr>
</table>'; 
echo '<br><br><br>
<table border="1px">
<tr><td style="text-align: center;" colspan="2">Aktualnoœci</td></tr>';
$aktualnosci="SELECT * FROM aktualnosci";
$wykonaj=mysqli_query($link,$aktualnosci);
if(@mysqli_num_rows($wykonaj)){
while($wiersz=mysqli_fetch_assoc($wykonaj)) {
echo '<tr><td width="150">'.$wiersz['data'].'</td><td width="950">'.$wiersz['opis'].'</tr></table>';
}
}
}
?>
</center>

<script>

var d = document.getElementById('dodaj');
var pd = document.getElementById('p_dodaj');

function dodaj() {
    if (d.style.display === 'none') {
        d.style.display = '';
        pd.style.display = '';
    } else {
        d.style.display = 'none';
        pd.style.display = 'none';
    }
}
</script>
</body>
</html>
\end{verbatim}.


\paragraph{Tytu³ zadania.} Aktualnoœci. \subparagraph{Wykonawca.} Pawe³ Wilczek \subparagraph{Realizacja.} Zadanie polega³o na utworzeniu aktualnoœci na stronie g³ównej przychodni lekarskiej dziêki wy³uskaniu odpowiednich informacji z tabeli "aktualnoœci" i umieszczeniu ich na stronie g³ównej dziêki skryptowi PHP. 

Tabela aktualnoœci:
\begin{verbatim}
CREATE TABLE aktualnosci (
id_aktualnosci INT NOT NULL auto_increment,
data TIMESTAMP NOT NULL,
opis VARCHAR(50) NOT NULL,

CONSTRAINT c_pk0 PRIMARY KEY(id_aktualnosci)
) ENGINE = InnoDB;
\end{verbatim}
Skrypt PHP:
\begin{verbatim}
echo '<br><br><br>
<table border="1px">
<tr><td style="text-align: center;" colspan="2">Aktualnoœci</td></tr>';
$aktualnosci="SELECT * FROM aktualnosci";
$wykonaj=mysqli_query($link,$aktualnosci);
if(@mysqli_num_rows($wykonaj)){
	while($wiersz=mysqli_fetch_assoc($wykonaj)) {
		echo '<tr><td width="150">'.$wiersz['data'].'</td><td width="950">'.$wiersz['opis'].'</tr></table>';
}
}
}
\end{verbatim}

\subsection{Sprint Review/Demo} Naszym celem by³a realizacja 3 wczeœniej ustalonych i zaplanowanych zadañ. Dotyczy³y one stworzenia bazy danych, strony tytu³owej oraz formularza logowania pacjenta a tak¿e aktualnoœci. Podczas realizacji wczeœniej przydzielonych zadañ, ¿aden z cz³onków zespo³u nie napotka³ na istotne, konieczne do odnotowania problemy. Wszystkie z przewidzianych zadañ zosta³y wykonane terminowo, co za tym idzie przyrost  zosta³ osi¹gniêty. Z racji tematyki naszego projektu, przyrost, postêp bedzie dostêpny na stronie internetowej przychodni, w adresie poni¿ej.\newline
\newline
\textit{Demonstracja przyrostu produktu:}\newline
\newline
\textbf{Link do strony}: http://luki9696.000webhostapp.com/projekt/index.php
 
   

\section{Sprint 2}
\label{Sprint22}
\subsection{Cel}\label{Sprint2cel} <<Okreœliæ, w jakim celu tworzony jest przyrost produktu>>.

\subsection{Sprint Planning/Backlog}
\label{Sprint2SPB}
\paragraph{Tytu³ zadania.} Formularz zapisu dla pacjentów. \begin{itemize} \item Estymata: M. \end{itemize}

\paragraph{Tytu³ zadania.} Aktualizacja bazy danych. \begin{itemize} \item Estymata: XL. \end{itemize}


\paragraph{<<Tutaj dodawaæ kolejne zadania>>}

\subsection{Realizacja}
\label{Realizacja2}
\paragraph{Tytu³ zadania.} <<Tytu³>>. \subparagraph{Wykonawca.} <>. \subparagraph{Realizacja.} <<Sprawozdanie z realizacji zadania (w tym ocena zgodnoœci z estymat¹). Kod programu (œrodowisko \texttt{verbatim}): \begin{verbatim} for (i=1; i<10; i++) ... \end{verbatim}>>.

\paragraph{Tytu³ zadania.} <<Tytu³>>. \subparagraph{Wykonawca.} <>. \subparagraph{Realizacja.} <<Sprawozdanie z realizacji zadania (w tym ocena zgodnoœci z estymat¹). Kod programu (œrodowisko \texttt{verbatim}): \begin{verbatim} for (i=1; i<10; i++) ... \end{verbatim}>>.


\subsection{Sprint Review/Demo}\label{Sprint2demo} <<Sprawozdanie z przegl¹du Sprint'u -- czy za³o¿ony cel (przyrost) zosta³ osi¹gniêty oraz czy wszystkie zaplanowane Backlog Item'y zosta³y zrealizowane? Demostracja przyrostu produktu>>.


\section{Sprint 3}\label{Sprint33} \subsection{Cel}\label{Sprint33cel} <<Okreœliæ, w jakim celu tworzony jest przyrost produktu>>. \subsection{Sprint Planning/Backlog}\label{Sprint33SPB}

\paragraph{Tytu³ zadania.} Strona logowania pracowników. \begin{itemize} \item Estymata: XL. \end{itemize}
\paragraph{Tytu³ zadania.} Wyœwietlanie, edycja, usuwanie. \begin{itemize} \item Estymata: XXL. \end{itemize}

\paragraph{<<Tutaj dodawaæ kolejne zadania>>}

\subsection{Realizacja}\label{Sprint33realizacja}

\paragraph{Tytu³ zadania.} <<Tytu³>>. \subparagraph{Wykonawca.} <>. \subparagraph{Realizacja.} <<Sprawozdanie z realizacji zadania (w tym ocena zgodnoœci z estymat¹). Kod programu (œrodowisko \texttt{verbatim}): \begin{verbatim} for (i=1; i<10; i++) ... \end{verbatim}>>.

\paragraph{Tytu³ zadania.} <<Tytu³>>. \subparagraph{Wykonawca.} <>. \subparagraph{Realizacja.} <<Sprawozdanie z realizacji zadania (w tym ocena zgodnoœci z estymat¹). Kod programu (œrodowisko \texttt{verbatim}): \begin{verbatim} for (i=1; i<10; i++) ... \end{verbatim}>>.



\subsection{Sprint Review/Demo}\label{Sprint33demo} <<Sprawozdanie z przegl¹du Sprint'u -- czy za³o¿ony cel (przyrost) zosta³ osi¹gniêty oraz czy wszystkie zaplanowane Backlog Item'y zosta³y zrealizowane? Demostracja przyrostu produktu>>.

\section*{<<Tutaj dodawaæ kolejne Sprint'y>>}

\begin{thebibliography}{9}

\bibitem{Cov} S. R. Covey, {\em 7 nawyków skutecznego dzia³ania}, Rebis, Poznañ, 2007.

\bibitem{Oet} Tobias Oetiker i wsp., Nie za krótkie wprowadzenie do systemu \LaTeX \ $2_\varepsilon$, \url{ftp://ftp.gust.org.pl/TeX/info/lshort/polish/lshort2e.pdf}

\bibitem{SchSut} K. Schwaber, J. Sutherland, {\em Scrum Guide}, \url{http://www.scrumguides.org/}, 2016.

\bibitem{apr} \url{https://agilepainrelief.com/notesfromatooluser/tag/scrum-by-example}

\bibitem{us} \url{https://www.tutorialspoint.com/scrum/scrum_user_stories.htm}

\end{thebibliography}

\end{document}

% ----------------------------------------------------------------